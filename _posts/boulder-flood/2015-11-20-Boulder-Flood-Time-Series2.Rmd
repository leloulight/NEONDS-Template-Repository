---
title: "Boulder-Flood"
output: html_document
---



```{r}
library(lubridate)
library(ggplot2)

```

Open the data.

```{r import-discharge, echo=FALSE}
#SOURCe
#http://nwis.waterdata.usgs.gov/co/nwis/uv/?cb_00065=on&cb_00060=on&format=rdb&site_no=06730200&period=&begin_date=2013-01-01&end_date=2013-12-31
#import data
discharge <- read.table("precip-discharge/2013-discharge.txt",
                        sep="\t",
                        stringsAsFactors = FALSE,
                        skip=25,
                        header=TRUE)

#view first few lines
head(discharge)

#remove the first line from the data frame (which is a second list of headers)
boulderStrDis.2013 <- discharge[2:nrow(discharge),]

#view names
names(boulderStrDis.2013)

#rename headers so they are more meaningful
names(boulderStrDis.2013)[5] <- "disValue"

#view names
names(boulderStrDis.2013)
```

Let's have a look at the structure of our data. It appears as if the discharge 
value is a character class. This is likely because we had an additional row in our
data. Let's convert the discharge column to a numeric class. It appears as if 
`integer` will work given there are no decimal places in our data.

```{r adjust-data-structure }
#view structure of data
str(boulderStrDis.2013)

#convert column to integer
boulderStrDis.2013$disValue <- as.integer(boulderStrDis.2013$disValue)

class(boulderStrDis.2013$disValue)
str(boulderStrDis.2013)

```

#Converting Time Stamps
We have converted our discharge data to an integer format. However the time stamp
is still a character class. Let's convert it to a time class for efficient plotting,
next.

```{r convert-time }
#view class
class(boulderStrDis.2013$datetime)

#convert to date/time class - POSIX
boulderStrDis.2013$datetime <- as.POSIXct(boulderStrDis.2013$datetime)

#recheck data structure
str(boulderStrDis.2013)

#make sure there are no null values in our datetime field
sum(is.na(boulderStrDis.2013$datetime ))

```


Great - let's plot the data. We can use GGPLOT to plot.

```{r }

ggplot(boulderStrDis.2013, aes(datetime, disValue)) +
  geom_point()

```


We can plot a subset of our data too. Let's specify the months directly around
the boulder flood - so August - October 2013.

```{r define-time-subset }

#just subset the plot to the month of Aug15-oct15
startTime <- as.POSIXct("2013-08-15 00:00:00")
endTime <- as.POSIXct("2013-10-15 00:00:00")

limits <- c(startTime,endTime)

```

#GGPLOT - 

One nice way to keep track of featured added to your plot in ggplot, is by first 
creating ... 

```{r plot-subset }
#plot the data - September-October
disPlot <- ggplot(data=boulderStrDis.2013,
       aes(datetime,disValue)) +
      geom_point() +
      scale_x_datetime(limits=limits)
      
#add title and labels
disPlot + theme(axis.title.x = element_blank()) +
          xlab("Time") + ylab("Stream Discharge CFS") +
          ggtitle("Stream Discharge - Station\n Boulder Creek 2013")


```

#Publish to Plot.ly

```{r plot.ly }

#code here

```

#Explore Precipitation During the Flood

```{r import-precip }

precip.boulder <- read.csv("precip-discharge/2013-precip-data-640457.csv",
                           stringsAsFactors = FALSE)


#convert date time
precip.boulder$DATE <- as.POSIXct(precip.boulder$DATE,
                                  format="%Y%m%d %H:%M")

#clean up no data values
precip.boulder$HPCP[precip.boulder$HPCP==99999] <- NA

#plot the data - September-October
precPlot <- ggplot(data=precip.boulder,
       aes(DATE,HPCP)) +
      geom_point() +
      scale_x_datetime(limits=limits) +
      scale_y_continuous(limits = c(0, 300))
      
#add title and labels
precPlot + theme(axis.title.x = element_blank()) +
          xlab("Time") + ylab("Precipitation (100th of an inch)") +
          ggtitle("Hourly Precipitation - Boulder - Station\n Boulder Creek 2013")

```


```{r daily-summaries }

library(plyr)
#add a day column in the data frame
precip.boulder$daily <- floor_date(precip.boulder$DATE, "day")

dailyPrecip.boulder <- ddply(precip.boulder, "daily",summarise, x=sum(HPCP))


#plot the data - September-October
precPlot <- ggplot(data=dailyPrecip.boulder,
      aes(daily,x)) +
      geom_point() +
      scale_x_datetime(limits=limits) +
      scale_y_continuous(limits = c(0, 800))
      
#add title and labels
precPlot + theme(axis.title.x = element_blank()) +
          xlab("Time") + ylab("Precipitation (100th of an inch)") +
          ggtitle("DAILY Precipitation - Boulder- Station\n Boulder Creek 2013")

```

